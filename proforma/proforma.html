<!DOCTYPE html>
<html lang="es">
<head>
    
            <meta http-equiv="Content-Security-Policy" content="
                default-src 'self' https: data:;
                img-src 'self' https: data:;
                style-src 'self' 'unsafe-inline' https://*.gstatic.com https://fonts.googleapis.com https://cdnjs.cloudflare.com;
                style-src-elem 'self' 'unsafe-inline' https://*.gstatic.com https://fonts.googleapis.com https://cdnjs.cloudflare.com;
                font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://fonts.googleapis.com data:;
                script-src 'self' 'unsafe-inline' 'unsafe-eval' https://translate.googleapis.com https://translate.google.com https://*.gstatic.com https://www.gstatic.com https://cdnjs.cloudflare.com;
                script-src-elem 'self' 'unsafe-inline' 'unsafe-eval' https://translate.googleapis.com https://translate.google.com https://*.gstatic.com https://www.gstatic.com https://cdnjs.cloudflare.com;
                connect-src 'self' https:;
                frame-src 'self' https://translate.google.com;">
        <style>
    .zoom-container {
      transform: scale(0.60);
      transform-origin: top center;
      width: 166.66%;
    }
  </style>
</head>
    <meta charset="UTF-8">
    <title>Proforma de Productos UP-CONS</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.2/html2canvas.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
   
   
   
   
   
   
    <style>
/* Tema NEON */
:root {
    /* Tema NEON CLARO */
    --neon-bg: #f7fbff;
    --neon-panel: rgba(255, 255, 255, 0.88);
    --neon-primary: #14b8ff; /* cian */
    --neon-secondary: #8b5cf6; /* violeta */
    --neon-accent: #06d6a0; /* verde */
    --neon-danger: #ff3864; /* rojo */
    --neon-text: #102035; /* texto oscuro */
    --neon-muted: #5b6b7c;
}

@keyframes neonPulse {
    0%, 100% { filter: drop-shadow(0 0 6px rgba(58, 239, 255, 0.45)); }
    50% { filter: drop-shadow(0 0 12px rgba(155, 92, 255, 0.45)); }
}

/* Estilo del botón flotante */
#calculator-btn {
    position: fixed;
    top: 20px;
    right: 20px;
    width: 54px;
    height: 54px;
    border-radius: 10px;
    object-fit: contain;
    background: transparent;
    border: none;
    box-shadow: none;
    cursor: pointer;
    touch-action: none;
    user-select: none;
    -webkit-user-drag: none;
    transition: transform 0.15s ease;
    z-index: 9999;
    display: inline-block;
}

#calculator-btn:hover { 
    transform: translateY(-1px);
}

#calculator-btn.dragging {
    transform: scale(1.02);
}

/* Estilo de la calculadora (neon) */
#calculator {
    position: fixed;
    top: 70px;
    right: 10px;
    width: 260px;
    background: var(--neon-panel);
    border: 1px solid rgba(20,184,255,0.35);
    border-radius: 14px;
    padding: 10px;
    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08), 0 0 18px rgba(20,184,255,0.18), 0 0 26px rgba(139,92,246,0.15);
    backdrop-filter: blur(4px);
    -webkit-backdrop-filter: blur(4px);
    z-index: 9998; 
}

/* Pantalla */
#calc-display {
    margin-bottom: 10px;
}

#calc-output {
    width: 100%;
    height: 52px; /* más pequeño */
    background: #ffffff;
    color: var(--neon-text);
    font-size: 24px; /* más pequeño */
    letter-spacing: 0.5px;
    text-align: right;
    border: 1px solid rgba(20,184,255,0.3);
    padding: 8px 12px;
    border-radius: 10px;
    box-shadow: inset 0 0 6px rgba(0,0,0,0.05), 0 0 0 1px rgba(255,255,255,0.7) inset;
    text-shadow: none;
    box-sizing: border-box; /* evita desbordes */
    overflow: hidden;
}

/* Botones */
#calc-buttons {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
}

/* Botones NEON */
#calc-buttons .btn {
    width: 100%;
    height: 48px; /* más compacto */
    display: inline-flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(180deg, #ffffff, #f3f7ff);
    color: var(--neon-text);
    font-size: 18px;
    border: 1px solid rgba(16,32,53,0.08);
    border-radius: 10px;
    cursor: pointer;
    box-shadow: 0 0 0 1px rgba(255,255,255,0.8) inset, 0 4px 10px rgba(0, 0, 0, 0.08);
    transition: transform 0.12s ease, box-shadow 0.12s ease, color 0.12s ease, background 0.12s ease;
}

#calc-buttons .btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 0 0 1px rgba(255,255,255,0.9) inset, 0 6px 12px rgba(0,0,0,0.1), 0 0 10px rgba(20,184,255,0.18);
}

#calc-buttons .btn:active {
    transform: translateY(0);
}

/* Variantes */
#calc-buttons .btn-num { /* números y punto */
    color: var(--neon-text);
}

#calc-buttons .btn-op {
    color: var(--neon-secondary);
    border-color: rgba(139,92,246,0.35);
    text-shadow: none;
}

#calc-buttons .btn-ctrl { /* clear */
    color: var(--neon-danger);
    border-color: rgba(255,56,100,0.35);
}

/* Igual (=) especial */
#equal-btn.btn-equal {
    grid-row: span 2;
    background: linear-gradient(180deg, rgba(139,92,246,0.95), rgba(20,184,255,0.95));
    color: #0a1a29;
    font-size: 22px;
    font-weight: 800;
    border-color: rgba(20,184,255,0.45);
    box-shadow: 0 0 0 1px rgba(255,255,255,0.9) inset,
                0 8px 18px rgba(0,0,0,0.12),
                0 0 16px rgba(20,184,255,0.35),
                0 0 26px rgba(139,92,246,0.25);
    animation: neonPulse 4s ease-in-out infinite;
}

/* Botones compactos y bonitos para Guardar/Cargar Proforma */
.mini-action-btn {
    font-size: 11px;
    padding: 6px 10px;
    min-width: 120px; /* más pequeños */
    background: linear-gradient(180deg, #ffffff, #f3f7ff);
    color: #0f1f33;
    border: 1px solid rgba(16,32,53,0.12);
    border-radius: 10px;
    box-shadow: 0 1px 0 rgba(255,255,255,0.9) inset, 0 3px 8px rgba(0,0,0,0.08);
    transition: transform 0.12s ease, box-shadow 0.12s ease;
}
.mini-action-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 1px 0 rgba(255,255,255,1) inset, 0 6px 12px rgba(0,0,0,0.1);
}
.mini-action-btn:active {
    transform: translateY(0);
}




        
        
        
        html, body {
   height: 150%;
   margin: 0;
   padding: 0;
   overflow-y: auto !important;
   -webkit-overflow-scrolling: touch; /* Esto hace que el desplazamiento sea suave en dispositivos móviles */
}

.proforma-container { /* Reemplaza '.proforma-container' con el id o clase de tu contenedor principal */
   max-height: 100vh; /* Limita la altura máxima al 100% de la altura de la ventana */
   overflow-y: auto;  /* Habilita el scroll vertical */
}

#contenido {  /* Este es un ejemplo de contenedor. Reemplaza con tu contenedor real */
   position: relative;
   overflow-x: hidden;  /* Evita el scroll horizontal */
}

        
        
        
        
        
        
        
    body {
        font-family: 'Arial', sans-serif;
        background-color: #f4f4f4;
        margin: 0;
        padding: 20px;
        font-size: 12px;
    }
    .formulario {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-bottom: 10px;
    }
    select, input { /* Eliminamos el button de aquí para darle un estilo independiente */
        width: 100%;
        padding: 8px;
        margin-bottom: 8px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 12px;
    }
    button {
        background-color: #007bff;
        color: white;
        border: none;
        cursor: pointer;
        padding: 4px;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
        background-color: white;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    th, td {
        border: 1px solid #ddd;
        padding: 4px;
        text-align: left;
        font-size: 10px;
    }
    th {
        background-color: #007bff;
        color: white;
    }
    .proforma-container {
        background: white;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .item-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .item-details {
        flex-grow: 1;
        font-size: 10px;
    }
    .edit-icon, .close-btn {
        font-size: 16px;
        cursor: pointer;
    }
    .close-btn {
        color: red;
        border: none;
        background: transparent;
    }    

    /* Estilo para los botones "Agregar Producto" y "Guardar como Imagen" */
    .action-buttons-container {
        display: flex;
        justify-content: space-between; /* Para que estén uno al lado del otro */
        width: 100%; /* O el ancho que desees para los botones */
        gap: 10px; /* Espacio entre los botones */
        margin-top: 10px; /* Margen superior para separarlos de otros elementos */
    }

    .action-button {
        flex: 1; /* Para que ambos botones ocupen el mismo espacio */
        font-size: 13px;
        padding: 10px 5px; /* Ajusta el padding para hacerlos más rectangulares/cuadrados */
        border-radius: 5px; /* Bordes ligeramente redondeados */
        transition: background-color 0.2s, transform 0.1s;
    }

    .action-button:active {
        transform: scale(0.95); /* Efecto de aplastamiento */
    }

    #agregarBtn {
        background-color: #007bff; /* Color original o un verde si prefieres para agregar */
    }
    #agregarBtn:active {
        background-color: #0056b3; /* Un tono más oscuro al presionar */
    }

    #guardarImagenBtn {
        background-color: #28a745; /* Verde para guardar imagen */
    }
    #guardarImagenBtn:active {
        background-color: #1e7e34; /* Un tono más oscuro al presionar */
    }


    </style>
</head>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>


<body onload="inicializarProductos();">

                <div style="position:relative;min-height:54px;margin-bottom:8px;">
                    <h1 style="margin:0;font-size:1.45rem;">UP-CONS IMPORTADOR</h1>
                    <img id="calculator-btn" src="assets/calculadora.png" alt="Abrir calculadora" title="Calculadora" style="position:absolute;top:-18px;right:-8px;z-index:10;" />
                </div>
    <div class="formulario">
        
        
        
        
        <input type="text" id="buscador" placeholder="Buscar producto..." oninput="buscarProducto()">
<select id="producto" onchange="copiarNombreYPrecio()">
    </select>
            
    
    
    
    
    
    
    
    
    
  
               


<div id="calculator" style="display: none;">
    <div id="calc-display">
        <input type="text" id="calc-output" disabled />
    </div>
    <div id="calc-buttons">
        <button class="btn btn-ctrl" onclick="clearOutput()">C</button>
        <button class="btn btn-op" onclick="appendOperator('%')">%</button>
        <button class="btn btn-op" onclick="appendOperator('/')">/</button>
    <button class="btn btn-op" onclick="appendOperator('x')">x</button>

        <button class="btn btn-num" onclick="appendNumber(7)">7</button>
        <button class="btn btn-num" onclick="appendNumber(8)">8</button>
        <button class="btn btn-num" onclick="appendNumber(9)">9</button>
        <button class="btn btn-op" onclick="appendOperator('-')">-</button>

        <button class="btn btn-num" onclick="appendNumber(4)">4</button>
        <button class="btn btn-num" onclick="appendNumber(5)">5</button>
        <button class="btn btn-num" onclick="appendNumber(6)">6</button>
        <button class="btn btn-op" onclick="appendOperator('+')">+</button>

        <button class="btn btn-num" onclick="appendNumber(1)">1</button>
        <button class="btn btn-num" onclick="appendNumber(2)">2</button>
        <button class="btn btn-num" onclick="appendNumber(3)">3</button>
        <button id="equal-btn" class="btn btn-equal" rowspan="2" onclick="calculateResult()">=</button>

        <button class="btn btn-num" onclick="appendNumber(0)">0</button>
        <button class="btn btn-num" onclick="appendDot()">.</button>
    </div>
</div>


           
           
           
           
           
           
           
           
            
            
            
        <div class="item-container">
    <input type="text" id="nombreProducto" placeholder="Nombre del Producto" style="width: 230px; font-size: 12px;">
</div>

<div class="item-container">PRECIO ➡️
    <input type="number" id="precioProducto" placeholder="Precio del Producto" style="width: 100px; font-size: 12px;">
</div>
        
        
        
        
        
      <div style="display: flex; align-items: center;">
    <label for="cantidad" style="margin-right: 5px;">CANTIDAD ➡️</label>
    <input type="number" id="cantidad" placeholder="Cantidad" min="1" value="1" style="width: 80px; font-size: 12px;">
</div>
        
        
<div class="action-buttons-container">
    <button id="agregarBtn" class="action-button" onclick="agregarProducto()">✅ Agregar producto</button>
    <button id="guardarImagenBtn" class="action-button" onclick="guardarComoImagen()">⬇️🖼️Guardar como Imagen JPG</button>
</div>
    
    
    
    
    
<div style="display: flex; justify-content: space-between; width: 100%; margin-top: 10px; gap: 8px;">
    <button class="mini-action-btn" onclick="guardarPagina()">💾 Guardar Proforma</button>
    <button class="mini-action-btn" onclick="cargarPagina()">⬆️ Cargar Proforma</button>
</div>
 



    
    <input type="text" id="nombrePagina" placeholder="Nombre del archivo" style="width: 100%;">
    



    <div class="proforma-container" id="proforma">
        
        <table>
            
            <p>

        <div style="display:flex;align-items:center;justify-content:space-between;width:100%;margin-bottom:2px;">
            <img src="assets/logo.jpg" alt="Up-cons logo" style="height:28px;vertical-align:middle;display:inline-block;">
            <span style="font-size:22px;font-weight:bold;color:#102035;letter-spacing:2px;margin-left:12px;">PROFORMA</span>
        </div>
    
    <p></p>
    
    Direccion: Quito / Av. Ecuatoriana y Martín Santiago Icaza S44-65 <br>
    Telf: 0983801298 - 0995986366
</p>
            
            
            </p>NOTA: Estos precios pueden variar sin previo aviso.<p>
            
            
            <div>
                <label for="nombreCliente"> Cliente:</label>
                <input type="text" id="nombreCliente" placeholder="Nombre del Cliente">
            </div>
            
            <tr>
                <th>Producto</th>
                <th>Cant.</th>
                <th>Precio Uni.</th>
                <th>Subtotal </th>
                <th>Editar</th>
                <th>Eliminar</th>
            </tr>
        </table>
<h2 id="subtotal" style="font-size: 9px;"> </h2>
<h2 id="iva" style="font-size: 8px;"></h2>
<h2 id="total" style="font-size: 15px;">Total: $0.00</h2>


        <div>
            <label for="nombreVendedorDisplay">Vendedor:</label>
            <span id="nombreVendedorDisplay" style="font-weight: bold;"></span>
        </div>
            
        





<script>
// Mostrar/ocultar la calculadora al hacer clic en el botón
document.addEventListener('DOMContentLoaded', function() {
    var calcBtn = document.getElementById('calculator-btn');
    if (calcBtn) {
        calcBtn.addEventListener('click', function() {
            var calculator = document.getElementById('calculator');
            if (calculator.style.display === 'none' || calculator.style.display === '') {
                calculator.style.display = 'block';
            } else {
                calculator.style.display = 'none';
            }
        });
    }
});
  // otras funciones...


    // MODAL animado con botones traslúcidos para seleccionar vendedor
    function mostrarModalVendedor() {
        let modal = document.getElementById('modal-vendedor');
        if (modal) return;
        modal = document.createElement('div');
        modal.id = 'modal-vendedor';
        modal.innerHTML = `
            <div style="position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.28);z-index:10000;display:flex;align-items:center;justify-content:center;">
                <div style="display:flex;flex-direction:column;gap:12px;align-items:center;">
                    <div style='font-size:15px;font-weight:600;color:#222;margin-bottom:4px;text-shadow:0 2px 8px #fff;'>Selecciona el vendedor</div>
                    <div id="vendedor-btn-list" style="display:flex;flex-direction:column;gap:8px;">
                    </div>
                    <button id="modalVendedorCancelar" style="margin-top:6px;padding:5px 14px;background:#ff7043;color:#fff;border:none;border-radius:8px;font-size:13px;cursor:pointer;">Cancelar</button>
                </div>
            </div>
        `;
        document.body.appendChild(modal);
        // Lista de vendedores
        const vendedores = ["Fernando B.", "Ricardo B.", "Joselin S.", "Pedro H.", "Jonathan", "Guillermo"];
        const list = modal.querySelector('#vendedor-btn-list');
        vendedores.forEach((nombre, i) => {
            const btn = document.createElement('button');
            btn.textContent = nombre;
            btn.style.cssText = `
                padding: 7px 18px;
                font-size: 14px;
                font-weight: 500;
                color: #111;
                background: rgba(20,184,255,0.72);
                border: none;
                border-radius: 10px;
                box-shadow: 0 2px 10px rgba(20,184,255,0.10);
                cursor: pointer;
                outline: none;
                transition: transform 0.18s cubic-bezier(.4,2,.6,1), box-shadow 0.18s;
                opacity: 0;
                transform: scale(0.85) translateY(18px);
                backdrop-filter: blur(2px);
            `;
            setTimeout(() => {
                btn.style.opacity = '1';
                btn.style.transform = 'scale(1) translateY(0)';
            }, 60 + i*60);
            btn.onmouseover = () => btn.style.background = 'rgba(20,184,255,0.92)';
            btn.onmouseout = () => btn.style.background = 'rgba(20,184,255,0.72)';
            btn.onclick = () => {
                modal.remove();
                guardarComoImagenConVendedor(nombre);
            };
            list.appendChild(btn);
        });
        document.getElementById('modalVendedorCancelar').onclick = function() {
            modal.remove();
        };
    }

    window.guardarComoImagen = function() {
        mostrarModalVendedor();
    }

    function guardarComoImagenConVendedor(vendedor) {
        // Obtener el elemento donde se mostrará el nombre del vendedor
        const vendedorDisplay = document.getElementById('nombreVendedorDisplay');
        // Escribir el nombre del vendedor en la proforma
        vendedorDisplay.innerText = vendedor;

        const proforma = document.getElementById("proforma");
        // Esperar un pequeño tiempo para que el DOM se actualice
        setTimeout(() => {
            html2canvas(proforma, {
                scale: 2,
                useCORS: true,
                backgroundColor: "#ffffff"
            }).then((canvas) => {
                const dataUrl = canvas.toDataURL("image/jpeg", 1.0);
                const esIphone = /iPhone|iPad|iPod/i.test(navigator.userAgent);
                if (esIphone) {
                    const nuevaVentana = window.open();
                    nuevaVentana.document.write(`
                        <html>
                            <head><title>Guardar Imagen</title></head>
                            <body style=\"margin:0\">
                                <img src=\"${dataUrl}\" style=\"width:100%; height:auto;\" />
                            </body>
                        </html>
                    `);
                } else {
                    const enlace = document.createElement("a");
                    enlace.href = dataUrl;
                    enlace.download = "proforma.jpg";
                    enlace.click();
                }
                // Limpiar el nombre del vendedor después de guardar la imagen
                vendedorDisplay.innerText = "";
            });
        }, 100);
    }
</script>








    <script>
    // ID de la hoja de cálculo de Google Sheets
    const SHEET_ID =
    
    
    
    
     "2PACX-1vSfw3ECUvPvgX3ks-91DxTrywFIxO8AfCXNwEsuK6BQxQxu4k3NCdXiSd3603BctKJFqm9wv4ltIs5U";

    // Función para cargar productos desde Google Sheets
    async function cargarProductosDesdeGoogleSheets() {
        const url = `https://docs.google.com/spreadsheets/d/e/${SHEET_ID}/pub?output=csv`;

        try {
            const response = await fetch(url);
            const data = await response.text();

            console.log(data); // Para verificar que los datos se están obteniendo correctamente

            const productos = data.split("\n").map(line => line.split(","));
            
            // Verificar que los productos se han cargado
            if (productos.length > 0) {
                productos.forEach(function(producto) {
                    const nombreProducto = producto[0];
                    const precioProducto = producto[1] ? parseFloat(producto[1]) : null;

                    // Verificar si el precio está vacío o no es un número
                    if (!isNaN(precioProducto)) {
                        const option = document.createElement("option");
                        option.text = `${nombreProducto} - $${precioProducto.toFixed(2)}`;
                        document.getElementById("producto").add(option);
                    } else {
                        // Si no hay precio, solo muestra el nombre del producto
                        const option = document.createElement("option");
                        option.text = `${nombreProducto}`;
                        document.getElementById("producto").add(option);
                    }
                });
            }
        } catch (error) {
            console.error("Error cargando productos:", error);
        }
    }

    // Inicialización de productos
    function inicializarProductos() {
        cargarProductosDesdeGoogleSheets();
    }






    function buscarProducto() {
    const busqueda = document.getElementById("buscador").value.toLowerCase();
    const productos = document.querySelectorAll("#producto option"); // Asumiendo que tus productos están en un select

    const palabras = busqueda.split(" ").filter(palabra => palabra.trim() !== ""); // Separa las palabras y elimina espacios vacíos

    productos.forEach(producto => {
        const nombre = producto.textContent.toLowerCase();
        
        // Verifica si todas las palabras están en el nombre del producto
        const todasEncontradas = palabras.every(palabra => nombre.includes(palabra));
        
        if (todasEncontradas) {
            producto.style.display = ""; // Mostrar el producto
        } else {
            producto.style.display = "none"; // Ocultar el producto
        }
    });
}
    
    
    
    
    
    
    
    

    var productos = {};

    function copiarNombreYPrecio() {
        var seleccion = document.getElementById("producto");
        var nombrePrecio = seleccion.options[seleccion.selectedIndex].text.split(" - ");
        var nombreProducto = document.getElementById("nombreProducto");
        var precioProducto = document.getElementById("precioProducto");
        nombreProducto.value = nombrePrecio[0];
        precioProducto.value = parseFloat(nombrePrecio[1].replace("$", ""));
    }
    
    
    
    
    

    function agregarProducto() {
        var nombreProducto = document.getElementById("nombreProducto").value;
        var precio = parseFloat(document.getElementById("precioProducto").value);
        var cantidad = parseInt(document.getElementById("cantidad").value);

        if (nombreProducto && !isNaN(precio) && !isNaN(cantidad)) {
            var subtotal = precio * cantidad;
            productos[nombreProducto] = { precio: precio, cantidad: cantidad };
            var table = document.querySelector("table");
            var newRow = table.insertRow(table.rows.length);
            var cell1 = newRow.insertCell(0);
            var cell2 = newRow.insertCell(1);
            var cell3 = newRow.insertCell(2);
            var cell4 = newRow.insertCell(3);
            var cell5 = newRow.insertCell(4);
            var cell6 = newRow.insertCell(5);

            cell1.innerHTML = nombreProducto;
            cell2.innerHTML = cantidad;
            cell3.innerHTML = "$" + precio.toFixed(2);
            cell4.innerHTML = "$" + subtotal.toFixed(2);

            // Botón de edición
            var editButton = document.createElement("button");
            editButton.innerHTML = '<i class="fas fa-edit edit-icon"></i>';
            editButton.className = "edit-btn";
            editButton.onclick = function() {
                editarProducto(newRow, nombreProducto, precio, cantidad);
            };
            cell5.appendChild(editButton);

            // Botón de eliminación
            var deleteButton = document.createElement("button");
            deleteButton.innerHTML = '<i class="fas fa-trash-alt close-btn"></i>';
            deleteButton.className = "close-btn";
            deleteButton.onclick = function() {
                delete productos[nombreProducto];
                table.deleteRow(newRow.rowIndex);
                calcularTotal();
            };
            cell6.appendChild(deleteButton);

            calcularTotal();
        } else {
            alert("Por favor, ingrese un nombre y un precio válido.");
        }
    }    
    
    
    
    
    

    function editarProducto(row, nombreProducto, precio, cantidad) {
        row.cells[0].innerHTML = '<input type="text" value="' + nombreProducto + '">';
        row.cells[1].innerHTML = '<input type="number" value="' + cantidad + '" min="1">';
        row.cells[2].innerHTML = '<input type="number" value="' + precio + '">';
        row.cells[3].innerHTML = '<button onclick="actualizarProducto(this, \'' + nombreProducto + '\')">Actualizar</button>';
    }

    function actualizarProducto(btn, nombreOriginal) {
        var row = btn.parentNode.parentNode;
        var nombreProducto = row.cells[0].querySelector('input').value;
        var cantidad = parseInt(row.cells[1].querySelector('input').value);
        var precio = parseFloat(row.cells[2].querySelector('input').value);

        if (nombreProducto && !isNaN(cantidad) && !isNaN(precio)) {
            var subtotal = precio * cantidad;
            productos[nombreProducto] = { precio: precio, cantidad: cantidad };
            delete productos[nombreOriginal];

            row.cells[0].innerHTML = nombreProducto;
            row.cells[1].innerHTML = cantidad;
            row.cells[2].innerHTML = "$" + precio.toFixed(2);
            row.cells[3].innerHTML = "$" + subtotal.toFixed(2);

            calcularTotal();
        } else {
            alert("Por favor, ingrese valores válidos para nombre, cantidad y precio.");
        }
    }
    
    
    
    
    
    
    
    
    function calcularTotal() { 
    let subtotal = 0;
    const table = document.querySelector("table");

    // Sumamos subtotales (sin IVA)
    for (let i = 1; i < table.rows.length; i++) {
        if (table.rows[i].cells.length >= 4) {
            subtotal += parseFloat(table.rows[i].cells[3].innerHTML.replace("$", ""));
        }
    }

    // Cálculos
    const iva = subtotal * 0.0;
    const totalConIVA = subtotal + iva;

    // Mostrar resultados
    
    document.getElementById("total").innerHTML = "Total: $" + totalConIVA.toFixed(2);
}   


    
    
    
    
    
    
    
    
    
function guardarProforma() {
    const tablaHTML = document.querySelector("table").outerHTML;
    const subtotal = document.getElementById("subtotal").innerText;
    const iva = document.getElementById("iva").innerText;
    const total = document.getElementById("total").innerText;

    const contenido = `
        <html>
        <body>
            ${tablaHTML}
            <h2 id="subtotal" style="font-size: 9px;">${subtotal}</h2>
            <h2 id="iva" style="font-size: 8px;">${iva}</h2>
            <h2 id="total" style="font-size: 15px;">${total}</h2>
        </body>
        </html>
    `;

    const blob = new Blob([contenido], { type: "text/html" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "proforma.html";
    a.click();
    URL.revokeObjectURL(url);
}






    
    
    
    
    
    

    


function guardarPagina() {
    var nombrePagina = document.getElementById("nombrePagina").value || "proforma_guardada";
    var nombreCliente = document.getElementById("nombreCliente").value || "";
    var nombreVendedor = document.getElementById("nombreVendedorDisplay").innerText || "";

    // Clonar el contenido de la página y modificar campos dinámicos
    let htmlClonado = document.documentElement.outerHTML;

    // Insertar el valor del cliente
    htmlClonado = htmlClonado.replace(
        /<input type="text" id="nombreCliente"[^>]*>/,
        `<input type="text" id="nombreCliente" placeholder="Nombre del Cliente" value="${nombreCliente}">`
    );

    // Insertar el vendedor seleccionado
    htmlClonado = htmlClonado.replace(/<span id="nombreVendedorDisplay"[^>]*>.*<\/span>/,
        `<span id="nombreVendedorDisplay" style="font-weight: bold;">${nombreVendedor}</span>`
    );

    const blob = new Blob([htmlClonado], { type: "text/html" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = nombrePagina + ".html";
    a.click();
    URL.revokeObjectURL(a.href);
}








    function guardarComoJPG() {
        html2canvas(document.getElementById("proforma")).then(function(canvas) {
            var link = document.createElement('a');
            link.download = 'proforma.jpg';
            link.href = canvas.toDataURL("image/jpeg", 1.0);
            link.click();
        });


        html2canvas(document.getElementById("logo-container")).then(function(canvas) {
            html2canvas(document.getElementById("proforma")).then(function(proformaCanvas) {
                var combinedCanvas = document.createElement("canvas");
                combinedCanvas.width = Math.max(proformaCanvas.width, canvas.width);
                combinedCanvas.height = proformaCanvas.height + canvas.height;
                var context = combinedCanvas.getContext("2d");

                context.drawImage(proformaCanvas, 0, 0);
                context.drawImage(canvas, 0, proformaCanvas.height);

                var link = document.createElement('a');
                link.download = 'proforma_con_logo.jpg';
                link.href = combinedCanvas.toDataURL("image/jpeg", 1.0);
                link.click();
            });
        });
    }
    
    
    
    
    
    
    
    
    
    function cargarProforma(event) {
    const archivo = event.target.files[0];
    if (!archivo) return;

    const lector = new FileReader();
    lector.onload = function(e) {
        const contenido = e.target.result;
        const doc = new DOMParser().parseFromString(contenido, "text/html");

        // Restaurar tabla
        const tablaHTML = doc.querySelector("table");
        if (tablaHTML) {
            document.querySelector("table").innerHTML = tablaHTML.innerHTML;
        }

        // Restaurar totales
        const subtotal = doc.getElementById("subtotal");
        const iva = doc.getElementById("iva");
        const total = doc.getElementById("total");

        if (subtotal) document.getElementById("subtotal").innerText = subtotal.innerText;
        if (iva) document.getElementById("iva").innerText = iva.innerText;
        if (total) document.getElementById("total").innerText = total.innerText;
    };

    lector.readAsText(archivo);
}









    function cargarPagina() {
        var fileInput = document.createElement('input');
        fileInput.type = 'file';
        fileInput.accept = '.html';
        fileInput.onchange = function(event) {
            var file = event.target.files[0];
            if (!file) {
                alert("Por favor, seleccione un archivo.");
                return;
            }

            var reader = new FileReader();
            reader.onload = function(event) {
                var proformaData = event.target.result;
                document.documentElement.innerHTML = proformaData;
                establecerEventos(); // Llamada a la función para establecer eventos después de cargar
                calcularTotal();
            };
            reader.readAsText(file);
        };
        fileInput.click();
    }

    // Función para establecer los eventos de editar y eliminar productos
    function establecerEventos() {
        var editButtons = document.querySelectorAll(".edit-btn");
        var deleteButtons = document.querySelectorAll(".close-btn");

        editButtons.forEach(function(button) {
            button.onclick = function() {
                var row = this.parentNode.parentNode;
                var nombreProducto = row.cells[0].innerText;
                var precio = parseFloat(row.cells[2].innerText.substring(1));
                var cantidad = parseInt(row.cells[1].innerText);
                editarProducto(row, nombreProducto, precio, cantidad);
            };
        });

        deleteButtons.forEach(function(button) {
            button.onclick = function() {
                var row = this.parentNode.parentNode;
                var nombreProducto = row.cells[0].innerText;
                delete productos[nombreProducto];
                row.parentNode.removeChild(row);
                calcularTotal();
            };
        });
    }

    function mostrarFechaActual() {
        var fecha = new Date();
        var fechaString = fecha.toLocaleDateString('es-ES', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        var horaString = fecha.toLocaleTimeString('es-ES');
        var fechaHora = fechaString + ' - ' + horaString;

                var divFecha = document.createElement('div');
                        divFecha.innerHTML = '<p>Fecha: ' + fechaHora + '</p>' +
                            '<div style="text-align:center;margin-top:-2px;">' +
                            '<a href="https://www.conupcons.com" target="_blank" style="font-size:17px;color:#007bff;text-decoration:none;font-weight:600;">www.conupcons.com</a>' +
                            '</div>';

        var proformaContainer = document.getElementById('proforma');
        proformaContainer.appendChild(divFecha);
    }

    mostrarFechaActual();
    
    
    
   

function appendNumber(number) {
    var output = document.getElementById("calc-output");
    output.value += number;
}

function appendDot() {
    var output = document.getElementById("calc-output");
    output.value += ".";
}

function appendOperator(operator) {
    var output = document.getElementById("calc-output");
    output.value += " " + operator + " ";
}

function clearOutput() {
    document.getElementById("calc-output").value = "";
}

function calculateResult() {
    var output = document.getElementById("calc-output");
    try {
        let expression = output.value
            .replace(/%/g, "/100")
            .replace(/x/g, "*");
        output.value = eval(expression);
    } catch (error) {
        output.value = "Error";
    }
}

function toggleCalculator() {
    var calculator = document.getElementById("calculator");
    if (calculator.style.display === "none" || calculator.style.display === "") {
        calculator.style.display = "block";
    } else {
        calculator.style.display = "none";
    }
}

</script>


    
    
</body>
</html>
